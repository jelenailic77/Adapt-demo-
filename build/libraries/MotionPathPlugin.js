import{getRawPath as getRawPath,cacheRawPathMeasurements as cacheRawPathMeasurements,getPositionOnPath as getPositionOnPath,pointsToSegment as pointsToSegment,flatPointsToSegment as flatPointsToSegment,sliceRawPath as sliceRawPath,stringToRawPath as stringToRawPath,rawPathToString as rawPathToString,transformRawPath as transformRawPath,convertToPath as _convertToPath}from"./utils/paths.js";import{getGlobalMatrix as getGlobalMatrix}from"./utils/matrix.js";var gsap,PropTween,_getUnit,_toArray,_xProps="x,translateX,left,marginLeft,xPercent".split(","),_yProps="y,translateY,top,marginTop,yPercent".split(","),_DEG2RAD=Math.PI/180,_getGSAP=function(){return gsap||"undefined"!=typeof window&&(gsap=window.gsap)&&gsap.registerPlugin&&gsap},_populateSegmentFromArray=function(t,e,a,n){for(var r=e.length,o=2===n?0:n,i=0;i<r;i++)t[o]=parseFloat(e[i][a]),2===n&&(t[o+1]=0),o+=2;return t},_getPropNum=function(t,e,a){return parseFloat(t._gsap.get(t,e,a||"px"))||0},_relativize=function(t){for(var e=t[0],a=t[1],n=2;n<t.length;n+=2)e=t[n]+=e,a=t[n+1]+=a},_segmentToRawPath=function(t,e,a,n,r,o,i,s,g){return e="cubic"===i.type?[e]:(!1!==i.fromCurrent&&e.unshift(_getPropNum(a,n,s),r?_getPropNum(a,r,g):0),i.relative&&_relativize(e),[(r?pointsToSegment:flatPointsToSegment)(e,i.curviness)]),e=o(_align(e,a,i)),_addDimensionalPropTween(t,a,n,e,"x",s),r&&_addDimensionalPropTween(t,a,r,e,"y",g),cacheRawPathMeasurements(e,i.resolution||(0===i.curviness?20:12))},_emptyFunc=function(t){return t},_numExp=/[-+\.]*\d+\.?(?:e-|e\+)?\d*/g,_originToPoint=function(t,e,a){var n,r=getGlobalMatrix(t),o=0,i=0;return"svg"===(t.tagName+"").toLowerCase()?(n=t.viewBox.baseVal).width||(n={width:+t.getAttribute("width"),height:+t.getAttribute("height")}):n=e&&t.getBBox&&t.getBBox(),e&&"auto"!==e&&(o=e.push?e[0]*(n?n.width:t.offsetWidth||0):e.x,i=e.push?e[1]*(n?n.height:t.offsetHeight||0):e.y),a.apply(o||i?r.apply({x:o,y:i}):{x:r.e,y:r.f})},_getAlignMatrix=function(t,e,a,n){var r,o=getGlobalMatrix(t.parentNode,!0,!0),i=o.clone().multiply(getGlobalMatrix(e)),s=_originToPoint(t,a,o),a=_originToPoint(e,n,o),o=a.x,a=a.y;return i.e=i.f=0,"auto"===n&&e.getTotalLength&&"path"===e.tagName.toLowerCase()&&(r=e.getAttribute("d").match(_numExp)||[],o+=(r=i.apply({x:+r[0],y:+r[1]})).x,a+=r.y),(r||e.getBBox&&t.getBBox&&e.ownerSVGElement===t.ownerSVGElement)&&(o-=(r=i.apply(e.getBBox())).x,a-=r.y),i.e=o-s.x,i.f=a-s.y,i},_align=function(t,e,a){var n,r=a.align,o=a.matrix,i=a.offsetX,s=a.offsetY,g=a.alignOrigin,p=t[0][0],h=t[0][1],u=_getPropNum(e,"x"),a=_getPropNum(e,"y");return t&&t.length?(r&&("self"===r||(n=_toArray(r)[0]||e)===e?transformRawPath(t,1,0,0,1,u-p,a-h):(g&&!1!==g[2]?gsap.set(e,{transformOrigin:100*g[0]+"% "+100*g[1]+"%"}):g=[_getPropNum(e,"xPercent")/-100,_getPropNum(e,"yPercent")/-100],h=(g=_getAlignMatrix(e,n,g,"auto")).apply({x:p,y:h}),transformRawPath(t,g.a,g.b,g.c,g.d,u+g.e-(h.x-g.e),a+g.f-(h.y-g.f)))),o?transformRawPath(t,o.a,o.b,o.c,o.d,o.e,o.f):(i||s)&&transformRawPath(t,1,0,0,1,i||0,s||0),t):getRawPath("M0,0L0,0")},_addDimensionalPropTween=function(t,e,a,n,r,o){var i=e._gsap,s=i.harness,s=s&&s.aliases&&s.aliases[a],s=s&&s.indexOf(",")<0?s:a,a=t._pt=new PropTween(t._pt,e,s,0,0,_emptyFunc,0,i.set(e,s,t));a.u=_getUnit(i.get(e,s,o))||0,a.path=n,a.pp=r,t._props.push(s)},_sliceModifier=function(e,a){return function(t){return e||1!==a?sliceRawPath(t,e,a):t}},MotionPathPlugin={version:"3.10.3",name:"motionPath",register:function(t,e,a){_getUnit=(gsap=t).utils.getUnit,_toArray=gsap.utils.toArray,PropTween=a},init:function(t,e){if(!gsap)return console.warn("Please gsap.registerPlugin(MotionPathPlugin)"),!1;var a,n=[],r=(e="object"!=typeof e||e.style||!e.path?{path:e}:e).path,o=e.autoRotate,i=e.unitX,s=e.unitY,g=e.x,p=e.y,h=r[0],u=_sliceModifier(e.start,"end"in e?e.end:1);if(this.rawPaths=n,this.target=t,(this.rotate=o||0===o)&&(this.rOffset=parseFloat(o)||0,this.radians=!!e.useRadians,this.rProp=e.rotation||"rotation",this.rSet=t._gsap.set(t,this.rProp,this),this.ru=_getUnit(t._gsap.get(t,this.rProp))||0),!Array.isArray(r)||"closed"in r||"number"==typeof h)o=u(_align(getRawPath(e.path),t,e)),cacheRawPathMeasurements(o,e.resolution),n.push(o),_addDimensionalPropTween(this,t,e.x||"x",o,"x",e.unitX||"px"),_addDimensionalPropTween(this,t,e.y||"y",o,"y",e.unitY||"px");else{for(a in h)!g&&~_xProps.indexOf(a)?g=a:!p&&~_yProps.indexOf(a)&&(p=a);for(a in g&&p?n.push(_segmentToRawPath(this,_populateSegmentFromArray(_populateSegmentFromArray([],r,g,0),r,p,1),t,g,p,u,e,i||_getUnit(r[0][g]),s||_getUnit(r[0][p]))):g=p=0,h)a!==g&&a!==p&&n.push(_segmentToRawPath(this,_populateSegmentFromArray([],r,a,2),t,a,0,u,e,_getUnit(r[0][a])))}},render:function(t,e){var a=e.rawPaths,n=a.length,r=e._pt;for(1<t?t=1:t<0&&(t=0);n--;)getPositionOnPath(a[n],t,!n&&e.rotate,a[n]);for(;r;)r.set(r.t,r.p,r.path[r.pp]+r.u,r.d,t),r=r._next;e.rotate&&e.rSet(e.target,e.rProp,a[0].angle*(e.radians?_DEG2RAD:1)+e.rOffset+e.ru,e,t)},getLength:function(t){return cacheRawPathMeasurements(getRawPath(t)).totalLength},sliceRawPath:sliceRawPath,getRawPath:getRawPath,pointsToSegment:pointsToSegment,stringToRawPath:stringToRawPath,rawPathToString:rawPathToString,transformRawPath:transformRawPath,getGlobalMatrix:getGlobalMatrix,getPositionOnPath:getPositionOnPath,cacheRawPathMeasurements:cacheRawPathMeasurements,convertToPath:function(t,e){return _toArray(t).map(function(t){return _convertToPath(t,!1!==e)})},convertCoordinates:function(t,e,a){t=getGlobalMatrix(e,!0,!0).multiply(getGlobalMatrix(t));return a?t.apply(a):t},getAlignMatrix:_getAlignMatrix,getRelativePosition:function(t,e,a,n){n=_getAlignMatrix(t,e,a,n);return{x:n.e,y:n.f}},arrayToRawPath:function(t,e){t=_populateSegmentFromArray(_populateSegmentFromArray([],t,(e=e||{}).x||"x",0),t,e.y||"y",1);return e.relative&&_relativize(t),["cubic"===e.type?t:pointsToSegment(t,e.curviness)]}};_getGSAP()&&gsap.registerPlugin(MotionPathPlugin);export{MotionPathPlugin as MotionPathPlugin,MotionPathPlugin as default};